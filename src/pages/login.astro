---
// src/pages/login.astro
import "../styles/login.css";

// Componentes UI
import LoginBackground from "../components/login/LoginBackground.astro";
import CompanySelector from "../components/login/CompanySelector.astro";
import WelcomeModal from "../components/login/WelcomeModal.astro";
import LoginForm from "../components/login/LoginForm.astro";

// Imágenes (necesarias para mapear en el cliente)
import imgAnglo from "../img_companies/AngloAmerican_1.png";
import imgBesalco from "../img_companies/Besalco_1.png";
import imgLinkapsis from "../img_companies/Linkapsis_1.png";
import imgLlayLlay from "../img_companies/LlayLlay_1.png";

const logosMap = {
    "anglo american": imgAnglo.src,
    angloamerican: imgAnglo.src,
    besalco: imgBesalco.src,
    linkapsis: imgLinkapsis.src,
    llayllay: imgLlayLlay.src,
    "llay llay": imgLlayLlay.src,
};
---

<!doctype html>
<html lang="es">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Login - Sistema Canchas AngloAmerican</title>
    </head>
    <body>
        <LoginBackground />
        <CompanySelector />
        <WelcomeModal />
        <LoginForm />

        <script>
            import { LoginManager } from "../components/login/LoginManager";

            // Se pasa el mapa de logos desde el servidor (definido en frontmatter) al cliente
            // via define:vars o pasando un objeto JSON global, pero como importamos las imgs en build time,
            // necesitamos pasarlas.
            // Una forma limpia es recrear el objeto si importamos las imgs estaticas.
            // O usaremos un truco:
        </script>

        <script define:vars={{ logosMap }}>
            // Importar dinamicamente el manager o inicializarlo si ya fue importado
            // Nota: Al usar <script> con imports arriba, es module.
            // Para pasar 'logosMap' necesitamos conectarlo.

            // Mejor estrategia:
            // Usamos un pequeño inline script para exponer logosMap y luego el module script lo lee.
            window.logosMapGlobal = logosMap;
        </script>

        <script>
            import { LoginManager } from "../components/login/LoginManager";

            document.addEventListener("DOMContentLoaded", () => {
                const logos = (window as any).logosMapGlobal;
                new LoginManager(logos);
            });
        </script>
    </body>
</html>
