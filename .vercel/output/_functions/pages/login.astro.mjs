import { e as createComponent, r as renderTemplate, n as defineScriptVars, o as renderHead } from '../chunks/astro/server_B9J4CstS.mjs';
/* empty css                                 */
export { renderers } from '../renderers.mjs';

const imgAnglo = new Proxy({"src":"/_astro/AngloAmerican_1.Bv6Smvju.png","width":475,"height":106,"format":"png"}, {
						get(target, name, receiver) {
							if (name === 'clone') {
								return structuredClone(target);
							}
							if (name === 'fsPath') {
								return "E:/TITO/1 Astro/canchas-anglo2/src/img_companies/AngloAmerican_1.png";
							}
							
							return target[name];
						}
					});

const imgBesalco = new Proxy({"src":"/_astro/Besalco_1.D-dokDlw.png","width":441,"height":114,"format":"png"}, {
						get(target, name, receiver) {
							if (name === 'clone') {
								return structuredClone(target);
							}
							if (name === 'fsPath') {
								return "E:/TITO/1 Astro/canchas-anglo2/src/img_companies/Besalco_1.png";
							}
							
							return target[name];
						}
					});

const imgLinkapsis = new Proxy({"src":"/_astro/Linkapsis_1.CJl6ntTK.png","width":602,"height":196,"format":"png"}, {
						get(target, name, receiver) {
							if (name === 'clone') {
								return structuredClone(target);
							}
							if (name === 'fsPath') {
								return "E:/TITO/1 Astro/canchas-anglo2/src/img_companies/Linkapsis_1.png";
							}
							
							return target[name];
						}
					});

const imgLlayLlay = new Proxy({"src":"/_astro/LlayLlay_1.B9ZxDX3G.png","width":200,"height":200,"format":"png"}, {
						get(target, name, receiver) {
							if (name === 'clone') {
								return structuredClone(target);
							}
							if (name === 'fsPath') {
								return "E:/TITO/1 Astro/canchas-anglo2/src/img_companies/LlayLlay_1.png";
							}
							
							return target[name];
						}
					});

var __freeze = Object.freeze;
var __defProp = Object.defineProperty;
var __template = (cooked, raw) => __freeze(__defProp(cooked, "raw", { value: __freeze(raw || cooked.slice()) }));
var _a;
const $$Login = createComponent(async ($$result, $$props, $$slots) => {
  const logosMap = {
    "anglo american": imgAnglo.src,
    angloamerican: imgAnglo.src,
    besalco: imgBesalco.src,
    linkapsis: imgLinkapsis.src,
    llayllay: imgLlayLlay.src,
    "llay llay": imgLlayLlay.src
  };
  return renderTemplate(_a || (_a = __template(['<html lang="es" data-astro-cid-sgpqyurt> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Login - Sistema Canchas AngloAmerican</title>', '</head> <body data-astro-cid-sgpqyurt> <canvas id="bg-canvas" data-astro-cid-sgpqyurt></canvas> <!-- VISTA 1: SELECCI\xD3N DE EMPRESA --> <div id="view-companies" class="company-selection-container fade-in" data-astro-cid-sgpqyurt> <div class="logo-section" data-astro-cid-sgpqyurt> <h1 class="main-title" data-astro-cid-sgpqyurt>Sistema de Canchas</h1> <p class="subtitle" data-astro-cid-sgpqyurt>Seleccione su empresa para ingresar</p> </div> <div id="companies-grid" class="companies-row" data-astro-cid-sgpqyurt> <!-- Se llena din\xE1micamente --> <div style="color: white; font-size: 1.2rem;" data-astro-cid-sgpqyurt>\nCargando empresas...\n</div> </div> </div> <!-- VISTA 2: FORMULARIO DE LOGIN --> <!-- Modal de Bienvenida --> <div id="welcome-modal" class="welcome-modal" data-astro-cid-sgpqyurt> <div class="welcome-modal-content" data-astro-cid-sgpqyurt> <div class="welcome-icon" data-astro-cid-sgpqyurt>\u26CF\uFE0F</div> <h2 class="welcome-title" data-astro-cid-sgpqyurt>\xA1Bienvenido!</h2> <p class="welcome-message" data-astro-cid-sgpqyurt>\nIniciando sesi\xF3n y cargando tu espacio de trabajo...\n</p> <div class="welcome-progress" data-astro-cid-sgpqyurt> <div class="welcome-progress-bar" data-astro-cid-sgpqyurt></div> </div> <div class="welcome-status" data-astro-cid-sgpqyurt>Preparando el sistema para ti</div> </div> </div> <div id="view-login" class="login-window hidden" data-astro-cid-sgpqyurt> <button type="button" class="back-btn" id="btn-back" data-astro-cid-sgpqyurt> <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-astro-cid-sgpqyurt><path d="M19 12H5M12 19l-7-7 7-7" data-astro-cid-sgpqyurt></path></svg>\nVolver\n</button> <div class="selected-company-header" data-astro-cid-sgpqyurt> <img id="selected-company-img" src="" alt="" class="selected-logo" data-astro-cid-sgpqyurt> <p style="color: #64748b; font-size: 0.9rem;" data-astro-cid-sgpqyurt>\nIngrese sus credenciales de acceso\n</p> </div> <form id="loginForm" data-astro-cid-sgpqyurt> <input type="hidden" id="empresaId" data-astro-cid-sgpqyurt> <div id="messageContainer" data-astro-cid-sgpqyurt></div> <div class="form-group" data-astro-cid-sgpqyurt> <label for="usuarioSelect" data-astro-cid-sgpqyurt>Usuario</label> <select id="usuarioSelect" class="form-control" required data-astro-cid-sgpqyurt> <option value="" data-astro-cid-sgpqyurt>Cargando usuarios...</option> </select> </div> <div class="form-group" data-astro-cid-sgpqyurt> <label for="passwordInput" data-astro-cid-sgpqyurt>Contrase\xF1a</label> <input type="password" id="passwordInput" class="form-control" placeholder="\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022" required data-astro-cid-sgpqyurt> </div> <button type="submit" class="btn-login" id="loginBtn" data-astro-cid-sgpqyurt> <span id="loginBtnText" data-astro-cid-sgpqyurt>Iniciar Sesi\xF3n</span> </button> </form> </div> <script>(function(){', '\n            // Particle Animation\n            class ParticleNetwork {\n                constructor(canvas) {\n                    this.canvas = canvas;\n                    this.ctx = canvas.getContext("2d");\n                    this.particles = [];\n                    this.mouse = { x: null, y: null };\n                    this.resize();\n                    this.init();\n\n                    window.addEventListener("resize", () => this.resize());\n                    window.addEventListener("mousemove", (e) => {\n                        this.mouse.x = e.x;\n                        this.mouse.y = e.y;\n                    });\n                    window.addEventListener("mouseout", () => {\n                        this.mouse.x = null;\n                        this.mouse.y = null;\n                    });\n\n                    this.animate();\n                }\n\n                resize() {\n                    this.canvas.width = window.innerWidth;\n                    this.canvas.height = window.innerHeight;\n                    this.init();\n                }\n\n                init() {\n                    this.particles = [];\n                    const particleCount = Math.min(\n                        window.innerWidth * 0.2,\n                        250,\n                    );\n\n                    for (let i = 0; i < particleCount; i++) {\n                        this.particles.push({\n                            x: Math.random() * this.canvas.width,\n                            y: Math.random() * this.canvas.height,\n                            vx: (Math.random() - 0.5) * 0.8,\n                            vy: (Math.random() - 0.5) * 0.8,\n                            size: Math.random() * 3 + 2,\n                            baseX: 0,\n                            baseY: 0,\n                        });\n                    }\n                }\n\n                animate() {\n                    this.ctx.clearRect(\n                        0,\n                        0,\n                        this.canvas.width,\n                        this.canvas.height,\n                    );\n\n                    this.particles.forEach((p, index) => {\n                        p.x += p.vx;\n                        p.y += p.vy;\n\n                        if (this.mouse.x != null) {\n                            const dx = p.x - this.mouse.x;\n                            const dy = p.y - this.mouse.y;\n                            const distance = Math.sqrt(dx * dx + dy * dy);\n                            const forceRadius = 150;\n\n                            if (distance < forceRadius) {\n                                const forceDirectionX = dx / distance;\n                                const forceDirectionY = dy / distance;\n                                const force =\n                                    (forceRadius - distance) / forceRadius;\n                                const directionX = forceDirectionX * force * 3;\n                                const directionY = forceDirectionY * force * 3;\n\n                                p.x += directionX;\n                                p.y += directionY;\n                            }\n                        }\n\n                        if (p.x < 0 || p.x > this.canvas.width) p.vx *= -1;\n                        if (p.y < 0 || p.y > this.canvas.height) p.vy *= -1;\n\n                        this.ctx.beginPath();\n                        this.ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);\n                        this.ctx.fillStyle = "rgba(37, 99, 235, 0.6)";\n                        this.ctx.fill();\n\n                        for (\n                            let j = index + 1;\n                            j < this.particles.length;\n                            j++\n                        ) {\n                            const p2 = this.particles[j];\n                            const dx = p.x - p2.x;\n                            const dy = p.y - p2.y;\n                            const distance = Math.sqrt(dx * dx + dy * dy);\n\n                            if (distance < 120) {\n                                this.ctx.beginPath();\n                                this.ctx.strokeStyle = `rgba(59, 130, 246, ${0.4 - distance / 1000})`;\n                                this.ctx.lineWidth = 0.6;\n                                this.ctx.moveTo(p.x, p.y);\n                                this.ctx.lineTo(p2.x, p2.y);\n                                this.ctx.stroke();\n                            }\n                        }\n                    });\n\n                    requestAnimationFrame(() => this.animate());\n                }\n            }\n\n            class LoginManager {\n                constructor() {\n                    // Vistas\n                    this.viewCompanies =\n                        document.getElementById("view-companies");\n                    this.viewLogin = document.getElementById("view-login");\n\n                    // Elementos Vista 1\n                    this.companiesGrid =\n                        document.getElementById("companies-grid");\n\n                    // Elementos Vista 2\n                    this.btnBack = document.getElementById("btn-back");\n                    this.selectedCompanyImg = document.getElementById(\n                        "selected-company-img",\n                    );\n                    this.empresaIdInput = document.getElementById("empresaId");\n                    this.usuarioSelect =\n                        document.getElementById("usuarioSelect");\n                    this.passwordInput =\n                        document.getElementById("passwordInput");\n                    this.loginForm = document.getElementById("loginForm");\n                    this.loginBtn = document.getElementById("loginBtn");\n                    this.loginBtnText = document.getElementById("loginBtnText");\n                    this.messageContainer =\n                        document.getElementById("messageContainer");\n\n                    this.init();\n                }\n\n                init() {\n                    // Init Particles\n                    const canvas = document.getElementById("bg-canvas");\n                    if (canvas) new ParticleNetwork(canvas);\n\n                    this.cargarEmpresas();\n                    this.setupEventListeners();\n                    this.checkExistingLogin();\n                }\n\n                setupEventListeners() {\n                    this.btnBack.addEventListener("click", () =>\n                        this.showCompaniesView(),\n                    );\n                    this.loginForm.addEventListener("submit", (e) =>\n                        this.onLogin(e),\n                    );\n                }\n\n                async cargarEmpresas() {\n                    try {\n                        const response = await fetch("/api/empresas");\n                        const data = await response.json();\n\n                        if (data.success && data.empresas) {\n                            this.renderEmpresas(data.empresas);\n                        } else {\n                            this.companiesGrid.innerHTML =\n                                \'<p style="color:#64748b">Error al cargar empresas</p>\';\n                        }\n                    } catch (error) {\n                        console.error("Error:", error);\n                        this.companiesGrid.innerHTML =\n                            \'<p style="color:#64748b">Error de conexi\xF3n</p>\';\n                    }\n                }\n\n                renderEmpresas(empresas) {\n                    this.companiesGrid.innerHTML = "";\n\n                    // Sort alphabetically to ensure grid order (Anglo, Besalco, Linkapsis, LlayLlay)\n                    empresas.sort((a, b) => a.nombre.localeCompare(b.nombre));\n\n                    empresas.forEach((empresa) => {\n                        const card = document.createElement("div");\n                        card.className = "company-card";\n\n                        // Buscar logo\n                        const normalizedName = empresa.nombre\n                            .toLowerCase()\n                            .trim();\n                        const logoSrc = logosMap[normalizedName] || null;\n\n                        let content = "";\n                        if (logoSrc) {\n                            content = `\n                            <div class="company-logo-container">\n                                <img src="${logoSrc}" alt="${empresa.nombre}">\n                            </div>\n                        `;\n                        }\n\n                        // Removed company name text as requested\n\n                        card.innerHTML = content;\n                        card.onclick = () =>\n                            this.selectCompany(empresa, logoSrc);\n\n                        this.companiesGrid.appendChild(card);\n                    });\n                }\n\n                selectCompany(empresa, logoSrc) {\n                    // Configurar vista de login\n                    this.empresaIdInput.value = empresa.id;\n\n                    if (logoSrc) {\n                        this.selectedCompanyImg.src = logoSrc;\n                        this.selectedCompanyImg.style.display = "block";\n                    } else {\n                        this.selectedCompanyImg.style.display = "none";\n                    }\n\n                    // Cambiar vista\n                    this.viewCompanies.classList.add("hidden");\n                    this.viewLogin.classList.remove("hidden");\n\n                    // Cargar usuarios\n                    this.loadUsuarios(empresa.id);\n                }\n\n                showCompaniesView() {\n                    this.viewLogin.classList.add("hidden");\n                    this.viewCompanies.classList.remove("hidden");\n                    this.passwordInput.value = "";\n                    this.messageContainer.innerHTML = "";\n                }\n\n                async loadUsuarios(empresaId) {\n                    this.usuarioSelect.innerHTML =\n                        \'<option value="">Cargando usuarios...</option>\';\n                    this.usuarioSelect.disabled = true;\n                    this.loginBtn.disabled = true;\n\n                    try {\n                        const response = await fetch(\n                            `/api/usuarios?empresa_id=${empresaId}&activo=true`,\n                        );\n                        const data = await response.json();\n\n                        if (data.success) {\n                            this.usuarioSelect.innerHTML =\n                                \'<option value="">Seleccione su usuario...</option>\';\n                            data.usuarios.forEach((usuario) => {\n                                const option = document.createElement("option");\n                                option.value = usuario.id;\n                                option.textContent = `${usuario.nombre_completo} (${usuario.rol_nombre})`;\n                                this.usuarioSelect.appendChild(option);\n                            });\n                            this.usuarioSelect.disabled = false;\n                            this.loginBtn.disabled = false;\n                            this.usuarioSelect.focus();\n                        } else {\n                            this.showMessage(\n                                "Error al cargar usuarios",\n                                "error",\n                            );\n                        }\n                    } catch (error) {\n                        this.showMessage("Error de conexi\xF3n", "error");\n                    }\n                }\n\n                async onLogin(event) {\n                    event.preventDefault();\n\n                    const empresaId = this.empresaIdInput.value;\n                    const usuarioId = this.usuarioSelect.value;\n                    const password = this.passwordInput.value;\n\n                    if (!usuarioId || !password) {\n                        this.showMessage("Complete todos los campos", "error");\n                        return;\n                    }\n\n                    this.setLoading(true);\n\n                    try {\n                        const response = await fetch("/api/auth/login", {\n                            method: "POST",\n                            headers: { "Content-Type": "application/json" },\n                            body: JSON.stringify({\n                                empresa_id: parseInt(empresaId),\n                                usuario_id: parseInt(usuarioId),\n                                password: password,\n                            }),\n                        });\n\n                        const data = await response.json();\n\n                        if (response.ok && data.success) {\n                            localStorage.setItem(\n                                "userSession",\n                                JSON.stringify({\n                                    usuario: data.usuario,\n                                    loginTime: new Date().toISOString(),\n                                    expiresAt: new Date(\n                                        Date.now() + 8 * 60 * 60 * 1000,\n                                    ).toISOString(),\n                                }),\n                            );\n\n                            this.showMessage(\n                                "\xA1Bienvenido! Ingresando...",\n                                "success",\n                            );\n                            setTimeout(\n                                () => (window.location.href = "/"),\n                                2800,\n                            );\n                        } else {\n                            this.showMessage(\n                                data.details || "Credenciales incorrectas",\n                                "error",\n                            );\n                            this.setLoading(false);\n                        }\n                    } catch (error) {\n                        this.showMessage("Error de conexi\xF3n", "error");\n                        this.setLoading(false);\n                    }\n                }\n\n                setLoading(loading) {\n                    if (loading) {\n                        this.loginBtn.disabled = true;\n                        this.loginBtnText.innerHTML =\n                            \'<div class="spinner" style="display:inline-block; vertical-align:middle; margin-right:8px;"></div> Verificando...\';\n                    } else {\n                        this.loginBtn.disabled = false;\n                        this.loginBtnText.textContent = "Iniciar Sesi\xF3n";\n                    }\n                }\n\n                showMessage(message, type) {\n                    // Si es un mensaje de \xE9xito de bienvenida, usar el modal especial\n                    if (\n                        type === "success" &&\n                        (message.includes("Bienvenido") ||\n                            message.includes("Ingresando"))\n                    ) {\n                        this.showWelcomeModal();\n                        return;\n                    }\n\n                    const className =\n                        type === "error" ? "message-error" : "message-success";\n                    const icon = type === "error" ? "\u26A0\uFE0F" : "\u2705";\n                    this.messageContainer.innerHTML = `\n                    <div class="message-box ${className}">\n                        <span>${icon}</span> ${message}\n                    </div>\n                `;\n                }\n\n                showWelcomeModal() {\n                    const modal = document.getElementById("welcome-modal");\n                    modal.classList.add("show");\n\n                    // Ocultar el modal despu\xE9s de 2.5 segundos\n                    setTimeout(() => {\n                        modal.classList.remove("show");\n                    }, 2500);\n                }\n\n                checkExistingLogin() {\n                    const session = localStorage.getItem("userSession");\n                    if (session) {\n                        try {\n                            const sessionData = JSON.parse(session);\n                            if (new Date(sessionData.expiresAt) > new Date()) {\n                                window.location.href = "/";\n                            }\n                        } catch (e) {\n                            localStorage.removeItem("userSession");\n                        }\n                    }\n                }\n            }\n\n            document.addEventListener("DOMContentLoaded", () => {\n                new LoginManager();\n            });\n        })();<\/script> </body> </html>'], ['<html lang="es" data-astro-cid-sgpqyurt> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Login - Sistema Canchas AngloAmerican</title>', '</head> <body data-astro-cid-sgpqyurt> <canvas id="bg-canvas" data-astro-cid-sgpqyurt></canvas> <!-- VISTA 1: SELECCI\xD3N DE EMPRESA --> <div id="view-companies" class="company-selection-container fade-in" data-astro-cid-sgpqyurt> <div class="logo-section" data-astro-cid-sgpqyurt> <h1 class="main-title" data-astro-cid-sgpqyurt>Sistema de Canchas</h1> <p class="subtitle" data-astro-cid-sgpqyurt>Seleccione su empresa para ingresar</p> </div> <div id="companies-grid" class="companies-row" data-astro-cid-sgpqyurt> <!-- Se llena din\xE1micamente --> <div style="color: white; font-size: 1.2rem;" data-astro-cid-sgpqyurt>\nCargando empresas...\n</div> </div> </div> <!-- VISTA 2: FORMULARIO DE LOGIN --> <!-- Modal de Bienvenida --> <div id="welcome-modal" class="welcome-modal" data-astro-cid-sgpqyurt> <div class="welcome-modal-content" data-astro-cid-sgpqyurt> <div class="welcome-icon" data-astro-cid-sgpqyurt>\u26CF\uFE0F</div> <h2 class="welcome-title" data-astro-cid-sgpqyurt>\xA1Bienvenido!</h2> <p class="welcome-message" data-astro-cid-sgpqyurt>\nIniciando sesi\xF3n y cargando tu espacio de trabajo...\n</p> <div class="welcome-progress" data-astro-cid-sgpqyurt> <div class="welcome-progress-bar" data-astro-cid-sgpqyurt></div> </div> <div class="welcome-status" data-astro-cid-sgpqyurt>Preparando el sistema para ti</div> </div> </div> <div id="view-login" class="login-window hidden" data-astro-cid-sgpqyurt> <button type="button" class="back-btn" id="btn-back" data-astro-cid-sgpqyurt> <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-astro-cid-sgpqyurt><path d="M19 12H5M12 19l-7-7 7-7" data-astro-cid-sgpqyurt></path></svg>\nVolver\n</button> <div class="selected-company-header" data-astro-cid-sgpqyurt> <img id="selected-company-img" src="" alt="" class="selected-logo" data-astro-cid-sgpqyurt> <p style="color: #64748b; font-size: 0.9rem;" data-astro-cid-sgpqyurt>\nIngrese sus credenciales de acceso\n</p> </div> <form id="loginForm" data-astro-cid-sgpqyurt> <input type="hidden" id="empresaId" data-astro-cid-sgpqyurt> <div id="messageContainer" data-astro-cid-sgpqyurt></div> <div class="form-group" data-astro-cid-sgpqyurt> <label for="usuarioSelect" data-astro-cid-sgpqyurt>Usuario</label> <select id="usuarioSelect" class="form-control" required data-astro-cid-sgpqyurt> <option value="" data-astro-cid-sgpqyurt>Cargando usuarios...</option> </select> </div> <div class="form-group" data-astro-cid-sgpqyurt> <label for="passwordInput" data-astro-cid-sgpqyurt>Contrase\xF1a</label> <input type="password" id="passwordInput" class="form-control" placeholder="\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022" required data-astro-cid-sgpqyurt> </div> <button type="submit" class="btn-login" id="loginBtn" data-astro-cid-sgpqyurt> <span id="loginBtnText" data-astro-cid-sgpqyurt>Iniciar Sesi\xF3n</span> </button> </form> </div> <script>(function(){', '\n            // Particle Animation\n            class ParticleNetwork {\n                constructor(canvas) {\n                    this.canvas = canvas;\n                    this.ctx = canvas.getContext("2d");\n                    this.particles = [];\n                    this.mouse = { x: null, y: null };\n                    this.resize();\n                    this.init();\n\n                    window.addEventListener("resize", () => this.resize());\n                    window.addEventListener("mousemove", (e) => {\n                        this.mouse.x = e.x;\n                        this.mouse.y = e.y;\n                    });\n                    window.addEventListener("mouseout", () => {\n                        this.mouse.x = null;\n                        this.mouse.y = null;\n                    });\n\n                    this.animate();\n                }\n\n                resize() {\n                    this.canvas.width = window.innerWidth;\n                    this.canvas.height = window.innerHeight;\n                    this.init();\n                }\n\n                init() {\n                    this.particles = [];\n                    const particleCount = Math.min(\n                        window.innerWidth * 0.2,\n                        250,\n                    );\n\n                    for (let i = 0; i < particleCount; i++) {\n                        this.particles.push({\n                            x: Math.random() * this.canvas.width,\n                            y: Math.random() * this.canvas.height,\n                            vx: (Math.random() - 0.5) * 0.8,\n                            vy: (Math.random() - 0.5) * 0.8,\n                            size: Math.random() * 3 + 2,\n                            baseX: 0,\n                            baseY: 0,\n                        });\n                    }\n                }\n\n                animate() {\n                    this.ctx.clearRect(\n                        0,\n                        0,\n                        this.canvas.width,\n                        this.canvas.height,\n                    );\n\n                    this.particles.forEach((p, index) => {\n                        p.x += p.vx;\n                        p.y += p.vy;\n\n                        if (this.mouse.x != null) {\n                            const dx = p.x - this.mouse.x;\n                            const dy = p.y - this.mouse.y;\n                            const distance = Math.sqrt(dx * dx + dy * dy);\n                            const forceRadius = 150;\n\n                            if (distance < forceRadius) {\n                                const forceDirectionX = dx / distance;\n                                const forceDirectionY = dy / distance;\n                                const force =\n                                    (forceRadius - distance) / forceRadius;\n                                const directionX = forceDirectionX * force * 3;\n                                const directionY = forceDirectionY * force * 3;\n\n                                p.x += directionX;\n                                p.y += directionY;\n                            }\n                        }\n\n                        if (p.x < 0 || p.x > this.canvas.width) p.vx *= -1;\n                        if (p.y < 0 || p.y > this.canvas.height) p.vy *= -1;\n\n                        this.ctx.beginPath();\n                        this.ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);\n                        this.ctx.fillStyle = "rgba(37, 99, 235, 0.6)";\n                        this.ctx.fill();\n\n                        for (\n                            let j = index + 1;\n                            j < this.particles.length;\n                            j++\n                        ) {\n                            const p2 = this.particles[j];\n                            const dx = p.x - p2.x;\n                            const dy = p.y - p2.y;\n                            const distance = Math.sqrt(dx * dx + dy * dy);\n\n                            if (distance < 120) {\n                                this.ctx.beginPath();\n                                this.ctx.strokeStyle = \\`rgba(59, 130, 246, \\${0.4 - distance / 1000})\\`;\n                                this.ctx.lineWidth = 0.6;\n                                this.ctx.moveTo(p.x, p.y);\n                                this.ctx.lineTo(p2.x, p2.y);\n                                this.ctx.stroke();\n                            }\n                        }\n                    });\n\n                    requestAnimationFrame(() => this.animate());\n                }\n            }\n\n            class LoginManager {\n                constructor() {\n                    // Vistas\n                    this.viewCompanies =\n                        document.getElementById("view-companies");\n                    this.viewLogin = document.getElementById("view-login");\n\n                    // Elementos Vista 1\n                    this.companiesGrid =\n                        document.getElementById("companies-grid");\n\n                    // Elementos Vista 2\n                    this.btnBack = document.getElementById("btn-back");\n                    this.selectedCompanyImg = document.getElementById(\n                        "selected-company-img",\n                    );\n                    this.empresaIdInput = document.getElementById("empresaId");\n                    this.usuarioSelect =\n                        document.getElementById("usuarioSelect");\n                    this.passwordInput =\n                        document.getElementById("passwordInput");\n                    this.loginForm = document.getElementById("loginForm");\n                    this.loginBtn = document.getElementById("loginBtn");\n                    this.loginBtnText = document.getElementById("loginBtnText");\n                    this.messageContainer =\n                        document.getElementById("messageContainer");\n\n                    this.init();\n                }\n\n                init() {\n                    // Init Particles\n                    const canvas = document.getElementById("bg-canvas");\n                    if (canvas) new ParticleNetwork(canvas);\n\n                    this.cargarEmpresas();\n                    this.setupEventListeners();\n                    this.checkExistingLogin();\n                }\n\n                setupEventListeners() {\n                    this.btnBack.addEventListener("click", () =>\n                        this.showCompaniesView(),\n                    );\n                    this.loginForm.addEventListener("submit", (e) =>\n                        this.onLogin(e),\n                    );\n                }\n\n                async cargarEmpresas() {\n                    try {\n                        const response = await fetch("/api/empresas");\n                        const data = await response.json();\n\n                        if (data.success && data.empresas) {\n                            this.renderEmpresas(data.empresas);\n                        } else {\n                            this.companiesGrid.innerHTML =\n                                \'<p style="color:#64748b">Error al cargar empresas</p>\';\n                        }\n                    } catch (error) {\n                        console.error("Error:", error);\n                        this.companiesGrid.innerHTML =\n                            \'<p style="color:#64748b">Error de conexi\xF3n</p>\';\n                    }\n                }\n\n                renderEmpresas(empresas) {\n                    this.companiesGrid.innerHTML = "";\n\n                    // Sort alphabetically to ensure grid order (Anglo, Besalco, Linkapsis, LlayLlay)\n                    empresas.sort((a, b) => a.nombre.localeCompare(b.nombre));\n\n                    empresas.forEach((empresa) => {\n                        const card = document.createElement("div");\n                        card.className = "company-card";\n\n                        // Buscar logo\n                        const normalizedName = empresa.nombre\n                            .toLowerCase()\n                            .trim();\n                        const logoSrc = logosMap[normalizedName] || null;\n\n                        let content = "";\n                        if (logoSrc) {\n                            content = \\`\n                            <div class="company-logo-container">\n                                <img src="\\${logoSrc}" alt="\\${empresa.nombre}">\n                            </div>\n                        \\`;\n                        }\n\n                        // Removed company name text as requested\n\n                        card.innerHTML = content;\n                        card.onclick = () =>\n                            this.selectCompany(empresa, logoSrc);\n\n                        this.companiesGrid.appendChild(card);\n                    });\n                }\n\n                selectCompany(empresa, logoSrc) {\n                    // Configurar vista de login\n                    this.empresaIdInput.value = empresa.id;\n\n                    if (logoSrc) {\n                        this.selectedCompanyImg.src = logoSrc;\n                        this.selectedCompanyImg.style.display = "block";\n                    } else {\n                        this.selectedCompanyImg.style.display = "none";\n                    }\n\n                    // Cambiar vista\n                    this.viewCompanies.classList.add("hidden");\n                    this.viewLogin.classList.remove("hidden");\n\n                    // Cargar usuarios\n                    this.loadUsuarios(empresa.id);\n                }\n\n                showCompaniesView() {\n                    this.viewLogin.classList.add("hidden");\n                    this.viewCompanies.classList.remove("hidden");\n                    this.passwordInput.value = "";\n                    this.messageContainer.innerHTML = "";\n                }\n\n                async loadUsuarios(empresaId) {\n                    this.usuarioSelect.innerHTML =\n                        \'<option value="">Cargando usuarios...</option>\';\n                    this.usuarioSelect.disabled = true;\n                    this.loginBtn.disabled = true;\n\n                    try {\n                        const response = await fetch(\n                            \\`/api/usuarios?empresa_id=\\${empresaId}&activo=true\\`,\n                        );\n                        const data = await response.json();\n\n                        if (data.success) {\n                            this.usuarioSelect.innerHTML =\n                                \'<option value="">Seleccione su usuario...</option>\';\n                            data.usuarios.forEach((usuario) => {\n                                const option = document.createElement("option");\n                                option.value = usuario.id;\n                                option.textContent = \\`\\${usuario.nombre_completo} (\\${usuario.rol_nombre})\\`;\n                                this.usuarioSelect.appendChild(option);\n                            });\n                            this.usuarioSelect.disabled = false;\n                            this.loginBtn.disabled = false;\n                            this.usuarioSelect.focus();\n                        } else {\n                            this.showMessage(\n                                "Error al cargar usuarios",\n                                "error",\n                            );\n                        }\n                    } catch (error) {\n                        this.showMessage("Error de conexi\xF3n", "error");\n                    }\n                }\n\n                async onLogin(event) {\n                    event.preventDefault();\n\n                    const empresaId = this.empresaIdInput.value;\n                    const usuarioId = this.usuarioSelect.value;\n                    const password = this.passwordInput.value;\n\n                    if (!usuarioId || !password) {\n                        this.showMessage("Complete todos los campos", "error");\n                        return;\n                    }\n\n                    this.setLoading(true);\n\n                    try {\n                        const response = await fetch("/api/auth/login", {\n                            method: "POST",\n                            headers: { "Content-Type": "application/json" },\n                            body: JSON.stringify({\n                                empresa_id: parseInt(empresaId),\n                                usuario_id: parseInt(usuarioId),\n                                password: password,\n                            }),\n                        });\n\n                        const data = await response.json();\n\n                        if (response.ok && data.success) {\n                            localStorage.setItem(\n                                "userSession",\n                                JSON.stringify({\n                                    usuario: data.usuario,\n                                    loginTime: new Date().toISOString(),\n                                    expiresAt: new Date(\n                                        Date.now() + 8 * 60 * 60 * 1000,\n                                    ).toISOString(),\n                                }),\n                            );\n\n                            this.showMessage(\n                                "\xA1Bienvenido! Ingresando...",\n                                "success",\n                            );\n                            setTimeout(\n                                () => (window.location.href = "/"),\n                                2800,\n                            );\n                        } else {\n                            this.showMessage(\n                                data.details || "Credenciales incorrectas",\n                                "error",\n                            );\n                            this.setLoading(false);\n                        }\n                    } catch (error) {\n                        this.showMessage("Error de conexi\xF3n", "error");\n                        this.setLoading(false);\n                    }\n                }\n\n                setLoading(loading) {\n                    if (loading) {\n                        this.loginBtn.disabled = true;\n                        this.loginBtnText.innerHTML =\n                            \'<div class="spinner" style="display:inline-block; vertical-align:middle; margin-right:8px;"></div> Verificando...\';\n                    } else {\n                        this.loginBtn.disabled = false;\n                        this.loginBtnText.textContent = "Iniciar Sesi\xF3n";\n                    }\n                }\n\n                showMessage(message, type) {\n                    // Si es un mensaje de \xE9xito de bienvenida, usar el modal especial\n                    if (\n                        type === "success" &&\n                        (message.includes("Bienvenido") ||\n                            message.includes("Ingresando"))\n                    ) {\n                        this.showWelcomeModal();\n                        return;\n                    }\n\n                    const className =\n                        type === "error" ? "message-error" : "message-success";\n                    const icon = type === "error" ? "\u26A0\uFE0F" : "\u2705";\n                    this.messageContainer.innerHTML = \\`\n                    <div class="message-box \\${className}">\n                        <span>\\${icon}</span> \\${message}\n                    </div>\n                \\`;\n                }\n\n                showWelcomeModal() {\n                    const modal = document.getElementById("welcome-modal");\n                    modal.classList.add("show");\n\n                    // Ocultar el modal despu\xE9s de 2.5 segundos\n                    setTimeout(() => {\n                        modal.classList.remove("show");\n                    }, 2500);\n                }\n\n                checkExistingLogin() {\n                    const session = localStorage.getItem("userSession");\n                    if (session) {\n                        try {\n                            const sessionData = JSON.parse(session);\n                            if (new Date(sessionData.expiresAt) > new Date()) {\n                                window.location.href = "/";\n                            }\n                        } catch (e) {\n                            localStorage.removeItem("userSession");\n                        }\n                    }\n                }\n            }\n\n            document.addEventListener("DOMContentLoaded", () => {\n                new LoginManager();\n            });\n        })();<\/script> </body> </html>'])), renderHead(), defineScriptVars({ logosMap }));
}, "E:/TITO/1 Astro/canchas-anglo2/src/pages/login.astro", void 0);

const $$file = "E:/TITO/1 Astro/canchas-anglo2/src/pages/login.astro";
const $$url = "/login";

const _page = /*#__PURE__*/Object.freeze(/*#__PURE__*/Object.defineProperty({
	__proto__: null,
	default: $$Login,
	file: $$file,
	url: $$url
}, Symbol.toStringTag, { value: 'Module' }));

const page = () => _page;

export { page };
