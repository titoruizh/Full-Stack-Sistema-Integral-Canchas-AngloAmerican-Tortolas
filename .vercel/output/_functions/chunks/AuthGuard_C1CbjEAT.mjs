import { e as createComponent, f as createAstro, r as renderTemplate, n as defineScriptVars } from './astro/server_B9J4CstS.mjs';

var __freeze = Object.freeze;
var __defProp = Object.defineProperty;
var __template = (cooked, raw) => __freeze(__defProp(cooked, "raw", { value: __freeze(raw || cooked.slice()) }));
var _a;
const $$Astro = createAstro();
const $$AuthGuard = createComponent(($$result, $$props, $$slots) => {
  const Astro2 = $$result.createAstro($$Astro, $$props, $$slots);
  Astro2.self = $$AuthGuard;
  const { requireRole, requireCompany, redirectTo = "/login" } = Astro2.props;
  return renderTemplate(_a || (_a = __template(["<script>(function(){", "\n  // AuthGuard - Protecci\xF3n de rutas del lado del cliente\n  class AuthGuard {\n    constructor(options = {}) {\n      this.requireRole = options.requireRole;\n      this.requireCompany = options.requireCompany;\n      this.redirectTo = options.redirectTo || '/login';\n      this.checkAuth();\n    }\n\n    checkAuth() {\n      try {\n        const sessionData = localStorage.getItem('userSession');\n        \n        if (!sessionData) {\n          this.redirectToLogin('No hay sesi\xF3n activa');\n          return;\n        }\n\n        const session = JSON.parse(sessionData);\n        const expiresAt = new Date(session.expiresAt);\n        \n        if (expiresAt <= new Date()) {\n          localStorage.removeItem('userSession');\n          this.redirectToLogin('Sesi\xF3n expirada');\n          return;\n        }\n\n        const user = session.usuario;\n\n        // Verificar rol espec\xEDfico si se requiere\n        if (this.requireRole && user.rol_nombre !== this.requireRole) {\n          this.redirectToLogin(`Se requiere el rol: ${this.requireRole}`);\n          return;\n        }\n\n        // Verificar empresa espec\xEDfica si se requiere\n        if (this.requireCompany && user.empresa_id !== this.requireCompany) {\n          this.redirectToLogin('No tiene permisos para acceder a esta empresa');\n          return;\n        }\n\n        // Autenticaci\xF3n exitosa\n        console.log('Usuario autenticado:', user.nombre_completo);\n        \n        // Dispatch evento de usuario cargado\n        window.dispatchEvent(new CustomEvent('userAuthenticated', { \n          detail: user \n        }));\n\n      } catch (error) {\n        console.error('Error verificando autenticaci\xF3n:', error);\n        this.redirectToLogin('Error de autenticaci\xF3n');\n      }\n    }\n\n    redirectToLogin(reason) {\n      console.warn('Redirigiendo al login:', reason);\n      \n      // Mostrar mensaje temporal si es posible\n      if (reason && window.location.pathname !== this.redirectTo) {\n        sessionStorage.setItem('authMessage', reason);\n      }\n      \n      window.location.href = this.redirectTo;\n    }\n  }\n\n  // Inicializar AuthGuard cuando el DOM est\xE9 listo\n  document.addEventListener('DOMContentLoaded', () => {\n    new AuthGuard({\n      requireRole,\n      requireCompany, \n      redirectTo\n    });\n  });\n})();<\/script>"], ["<script>(function(){", "\n  // AuthGuard - Protecci\xF3n de rutas del lado del cliente\n  class AuthGuard {\n    constructor(options = {}) {\n      this.requireRole = options.requireRole;\n      this.requireCompany = options.requireCompany;\n      this.redirectTo = options.redirectTo || '/login';\n      this.checkAuth();\n    }\n\n    checkAuth() {\n      try {\n        const sessionData = localStorage.getItem('userSession');\n        \n        if (!sessionData) {\n          this.redirectToLogin('No hay sesi\xF3n activa');\n          return;\n        }\n\n        const session = JSON.parse(sessionData);\n        const expiresAt = new Date(session.expiresAt);\n        \n        if (expiresAt <= new Date()) {\n          localStorage.removeItem('userSession');\n          this.redirectToLogin('Sesi\xF3n expirada');\n          return;\n        }\n\n        const user = session.usuario;\n\n        // Verificar rol espec\xEDfico si se requiere\n        if (this.requireRole && user.rol_nombre !== this.requireRole) {\n          this.redirectToLogin(\\`Se requiere el rol: \\${this.requireRole}\\`);\n          return;\n        }\n\n        // Verificar empresa espec\xEDfica si se requiere\n        if (this.requireCompany && user.empresa_id !== this.requireCompany) {\n          this.redirectToLogin('No tiene permisos para acceder a esta empresa');\n          return;\n        }\n\n        // Autenticaci\xF3n exitosa\n        console.log('Usuario autenticado:', user.nombre_completo);\n        \n        // Dispatch evento de usuario cargado\n        window.dispatchEvent(new CustomEvent('userAuthenticated', { \n          detail: user \n        }));\n\n      } catch (error) {\n        console.error('Error verificando autenticaci\xF3n:', error);\n        this.redirectToLogin('Error de autenticaci\xF3n');\n      }\n    }\n\n    redirectToLogin(reason) {\n      console.warn('Redirigiendo al login:', reason);\n      \n      // Mostrar mensaje temporal si es posible\n      if (reason && window.location.pathname !== this.redirectTo) {\n        sessionStorage.setItem('authMessage', reason);\n      }\n      \n      window.location.href = this.redirectTo;\n    }\n  }\n\n  // Inicializar AuthGuard cuando el DOM est\xE9 listo\n  document.addEventListener('DOMContentLoaded', () => {\n    new AuthGuard({\n      requireRole,\n      requireCompany, \n      redirectTo\n    });\n  });\n})();<\/script>"])), defineScriptVars({ requireRole, requireCompany, redirectTo }));
}, "E:/TITO/1 Astro/canchas-anglo2/src/components/AuthGuard.astro", void 0);

export { $$AuthGuard as $ };
